<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TillBlack — Studio</title>
    <meta name="description" content="TillBlack is a small studio crafting moody, atmospheric experiences — including Code of Shadows." />

    <!-- Canonical & Theme -->
    <link rel="canonical" href="https://tillblack.com/" /> <!-- TODO: set your real domain -->
    <meta name="theme-color" content="#0b0b0f" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#0b0b0f" media="(prefers-color-scheme: light)">

    <!-- Social cards -->
    <meta property="og:title" content="TillBlack — Studio" />
    <meta property="og:description" content="Atmospheric games & visuals. Code of Shadows by TillBlack." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://tillblack.com/og-image.jpg" /> <!-- TODO -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="TillBlack — Studio" />
    <meta name="twitter:description" content="Atmospheric games & visuals. Code of Shadows by TillBlack." />
    <meta name="twitter:image" content="https://tillblack.com/og-image.jpg" /> <!-- TODO -->

    <!-- Favicon (optional) -->
    <!-- <link rel="icon" href="/favicon.ico"> -->

    <style>
      :root{
        --fg: #ffffff;
        --fg-dim:#cfcfcf;
        --bg: #0b0b0f;
      }
      html,body{height:100%}
      body{
        margin:0; background:var(--bg); color:var(--fg);
        font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
        line-height:1.5; overflow:auto; -webkit-overflow-scrolling: touch;
      }

      #bg{position:fixed; inset:0; z-index:0;}
      .fade-top,.fade-bottom{display:none}

      /* Use small viewport unit to avoid iOS URL bar jumps */
      .wrap{position:relative; min-height:100svh; display:flex; justify-content:center; align-items:flex-start; padding:8vh 2rem 4.5rem}
      .card{ width:min(980px,94vw); border-radius:1.2rem; background:transparent; text-align:center; display:flex; flex-direction:column; justify-content:flex-start; }

      .brand{display:grid; place-items:center; margin-top:2rem}
      .brand .logo{
        display:block;
        width:clamp(140px, 22vw, 260px);
        height:auto; margin:0 auto;
        filter: drop-shadow(0 0 10px rgba(255,255,255,.12));
        mix-blend-mode:difference;
        animation: pulse-glow 5s ease-in-out infinite alternate, sway 10s ease-in-out infinite;
        will-change: filter, transform;
      }
      /* Tone down on touch devices (no hover) */
      @media (hover: hover) and (pointer: fine){
        .brand:hover .logo{
          animation: pulse-glow 1.4s ease-in-out infinite alternate, hover-shake .42s ease-in-out 1, sway 6s ease-in-out infinite;
        }
      }

      .blend, .blend *{ mix-blend-mode:difference; }
      .title{font-size: clamp(30px,5.2vw,56px); font-weight:800; margin:0 0 .6rem}
      .sub{color:var(--fg-dim); max-width:64ch; margin:0 auto 1rem; transition:opacity .4s ease}

      .cta{display:flex; gap:.8rem; justify-content:center; flex-wrap:wrap; margin-top:1rem}
      .btn{
        padding:.9rem 1.15rem; border-radius:.95rem; border:1px solid rgba(255,255,255,.18);
        background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
        color:var(--fg); text-decoration:none; font-weight:700;
        transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
      }
      .btn:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.32); box-shadow:0 0 34px rgba(255,255,255,.15)}

      @keyframes pulse-glow{ from{ filter: drop-shadow(0 0 6px rgba(255,255,255,.06)); } to{ filter: drop-shadow(0 0 18px rgba(255,255,255,.22)); } }
      @keyframes hover-shake{ 0%{ transform: translate(0,0) rotate(0) } 20%{ transform: translate(1px,-1px) rotate(.2deg) } 40%{ transform: translate(-1px,1px) rotate(-.2deg) } 60%{ transform: translate(1px,0) rotate(.15deg) } 80%{ transform: translate(0,-1px) rotate(-.15deg) } 100%{ transform: translate(0,0) rotate(0) } }
      @keyframes sway{ 0%{ transform: translateY(0) } 50%{ transform: translateY(-3px) } 100%{ transform: translateY(0) } }

      /* Respect reduced motion: kill CSS anims and JS RAF (handled in script too) */
      @media (prefers-reduced-motion: reduce){
        .brand .logo{ animation:none }
      }

      .steam-widget{margin-top:1.6rem; display:flex; justify-content:center}

      /* Keep footer readable without overlapping: add padding in .wrap above */
      footer{
        position:fixed; bottom:0; left:0; right:0;
        text-align:center; padding:1rem;
        font-size:13px; mix-blend-mode:difference; color:white;
        /* subtle divider glow for readability */
        background: linear-gradient(180deg, transparent, rgba(0,0,0,.35));
      }

      /* Small screens: slightly tighter paddings */
      @media (max-width: 420px){
        .wrap{ padding:6vh 1rem 5rem; }
        .btn{ padding:.8rem 1rem; }
      }
    </style>
  </head>
  <body>
    <canvas id="bg" aria-hidden="true"></canvas>

    <main class="wrap">
      <section class="card" aria-labelledby="site-title">
        <div class="blend">
          <h1 id="site-title" class="title">Build. Create. TillBlack.</h1>
          <p id="main-text" class="sub" aria-live="polite">
            TillBlack is a studio blending art and technology to craft moody, timeless experiences. Our current title is <strong>Code of Shadows</strong>.
          </p>
          <div class="cta">
            <a class="btn" href="https://store.steampowered.com/app/3424800/Code_of_Shadows/" rel="noopener">→ View on Steam</a>
            <a class="btn" href="mailto:hello@tillblack.com">Contact</a>
            <button class="btn" type="button" id="aboutBtn" aria-pressed="false">About</button>
          </div>
        </div>
        <div class="steam-widget">
          <iframe
            src="https://store.steampowered.com/widget/3424800/"
            title="Code of Shadows — Steam widget"
            frameborder="0"
            width="646"
            height="190"
            loading="lazy"
          ></iframe>
        </div>
        <div class="brand">
          <img
            class="logo"
            src="assets/TillBlack_Logo_black.png"
            alt="TillBlack logo"
            width="520" height="156"
            loading="lazy"
            decoding="async"
          />
        </div>
      </section>
    </main>

    <footer>
      <span class="blend">© <span id="year"></span> TillBlack. All rights reserved.</span>
    </footer>

    <!-- Three.js -->
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js" defer></script>

    <script>
      // Year stamp
      document.addEventListener('DOMContentLoaded', function(){
        document.getElementById('year').textContent = new Date().getFullYear();
      });

      // About toggle (button, better a11y)
      document.addEventListener('click', function(e){
        const btn = e.target.closest('#aboutBtn');
        if(!btn) return;
        const mainText = document.getElementById('main-text');
        const alt = mainText.dataset.alt === 'true';
        if(alt){
          mainText.innerHTML = 'TillBlack is a studio blending art and technology to craft moody, timeless experiences. Our current title is <strong>Code of Shadows</strong>.';
          mainText.dataset.alt = 'false';
          btn.setAttribute('aria-pressed', 'false');
        } else {
          mainText.innerHTML = 'Founded as a branch of DECOL, TillBlack aims to merge digital art and game design into unique, atmospheric projects that resonate beyond the screen.';
          mainText.dataset.alt = 'true';
          btn.setAttribute('aria-pressed', 'true');
        }
      });

      // ----- Shader background (perf-safe) -----
      const canvas = document.getElementById('bg');
      let renderer, scene, camera, uniforms, mesh, rafId = null;
      let motionReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function init(){
        if (motionReduced) {
          // Respect reduced motion: keep static background color.
          canvas.style.display = 'none';
          return;
        }
        if (!window.THREE) { return; } // three.js not loaded yet

        // Clamp DPR (big win on mobile battery/thermals)
        const isMobile = /Mobi|Android/i.test(navigator.userAgent);
        const cappedDPR = Math.min(window.devicePixelRatio || 1, isMobile ? 1.5 : 2);

        renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true, powerPreference: 'low-power' });
        renderer.setPixelRatio(cappedDPR);
        scene = new THREE.Scene();
        camera = new THREE.OrthographicCamera(-1,1,1,-1,0,1);

        const vertex = `varying vec2 vUv; void main(){ vUv = uv; gl_Position = vec4(position,1.0);} `;
        /* ---- Code of Shadows: black + burgundy/purple shader ---- */
        const fragment = `
          precision highp float; varying vec2 vUv; uniform float uTime; uniform vec2 uResolution;
          // Tunables
          uniform vec4 uParams;   // x=speed, y=grainAmt, z=bloomAmt, w=gridStrength
          uniform vec3 uBurgundy; // primary tint
          uniform vec3 uPurple;   // secondary tint

          vec2 hash(vec2 p){
            p = vec2(dot(p, vec2(127.1,311.7)), dot(p, vec2(269.5,183.3)));
            return -1.0 + 2.0*fract(sin(p)*43758.5453123);
          }
          float noise(in vec2 p){
            const float K1 = 0.366025404; const float K2 = 0.211324865;
            vec2 i = floor(p + (p.x+p.y)*K1);
            vec2 a = p - i + (i.x+i.y)*K2;
            vec2 o = (a.x>a.y) ? vec2(1.0,0.0) : vec2(0.0,1.0);
            vec2 b = a - o + K2; vec2 c = a - 1.0 + 2.0*K2;
            vec3 h = max(0.5 - vec3(dot(a,a), dot(b,b), dot(c,c)), 0.0);
            vec3 n = h*h*h*h*vec3(dot(a, hash(i + 0.0)), dot(b, hash(i + o)), dot(c, hash(i + 1.0)));
            return dot(n, vec3(70.0));
          }

          void main(){
            vec2 uv = vUv;
            vec2 p = (uv - 0.5) * vec2(uResolution.x/uResolution.y, 1.0);
            float t = uTime * uParams.x; // speed control

            float n1 = noise(p*1.6 + vec2( t*0.35, -t*0.22));
            float n2 = noise(p*3.1 + vec2(-t*0.18,  t*0.27));
            float field = smoothstep(-0.45, 0.85, n1 + n2*0.65);

            float scan = sin((uv.y + t*0.02) * 900.0) * 0.015;
            // Disable harsh grid pattern to avoid checker/diamond artifacts
            float grid = 0.0;

            float grain = (fract(sin(dot(uv*vec2(uResolution.x/uResolution.y,1.0) + t, vec2(12.9898,78.233))) * 43758.5453) - 0.5) * uParams.y;

            vec3 nearBlack = vec3(0.01, 0.005, 0.015);
            vec3 burgundy  = uBurgundy;
            vec3 purple    = uPurple;

            float tone = clamp(field*0.92 + grid*0.35 + scan*0.2, 0.0, 1.0);
            vec3 burgMix = mix(burgundy, purple, smoothstep(0.25, 0.95, tone));
            vec3 base    = mix(nearBlack, burgMix, tone);

            float vign = smoothstep(0.98, 0.35, length(uv-0.5));
            float bloom = smoothstep(0.6, 1.0, tone) * uParams.z; // bloom control

            vec3 col = base + bloom + grain;
            col *= vign;
            gl_FragColor = vec4(col, 1.0);
          }
        `;

        uniforms = {
          uTime: { value: 0 },
          uResolution: { value: new THREE.Vector2() },
          // Tunables: x=speed, y=grain amount, z=bloom amount, w=grid strength
          uParams: { value: new THREE.Vector4(0.08, 0.06, 0.08, 0.35) },
          // Palette uniforms for quick edits without touching shader code
          uBurgundy: { value: new THREE.Vector3(0.06, 0.02, 0.08) },
          uPurple:   { value: new THREE.Vector3(0.01, 0.00, 0.12) }
        };
        const geo = new THREE.PlaneGeometry(2,2);
        const mat = new THREE.ShaderMaterial({uniforms, vertexShader: vertex, fragmentShader: fragment, depthTest:false, depthWrite:false});
        mesh = new THREE.Mesh(geo, mat);
        scene.add(mesh);

        onResize();
        window.addEventListener('resize', onResize, { passive: true });

        // Handle tab visibility to save battery
        document.addEventListener('visibilitychange', onVisibilityChange);

        // Handle context loss gracefully
        renderer.domElement.addEventListener('webglcontextlost', function (event) {
          event.preventDefault();
          cancelAnim();
        }, false);
        renderer.domElement.addEventListener('webglcontextrestored', function () {
          startAnim();
        }, false);

        startAnim();
      }

      function onResize(){
        if(!renderer) return;
        const w = window.innerWidth, h = window.innerHeight;
        renderer.setSize(w, h, false);
        if (uniforms && uniforms.uResolution) uniforms.uResolution.value.set(w, h);
      }

      function tick(t){
        if (!renderer) return;
        uniforms.uTime.value = (t||0)*0.001;
        renderer.render(scene, camera);
        rafId = requestAnimationFrame(tick);
      }

      function startAnim(){
        if(rafId || motionReduced) return;
        rafId = requestAnimationFrame(tick);
      }
      function cancelAnim(){
        if(rafId){ cancelAnimationFrame(rafId); rafId = null; }
      }
      function onVisibilityChange(){
        if(document.hidden){ cancelAnim(); }
        else { startAnim(); }
      }

      // Kick things off when three.js is ready
      window.addEventListener('load', () => {
        try{ init(); } catch(e){ canvas.style.display='none'; console.warn('WebGL disabled:', e); }
      });

      // Respect reduced motion dynamically (if user toggles OS setting while open)
      window.matchMedia('(prefers-reduced-motion: reduce)').addEventListener('change', e => {
        motionReduced = e.matches;
        if(motionReduced){ cancelAnim(); canvas.style.display='none'; }
        else { canvas.style.display='block'; init(); }
      });
    </script>

    <noscript>
      <style>#bg{display:none}</style>
    </noscript>
  </body>
</html>
